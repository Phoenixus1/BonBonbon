
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Gestion Pro des Gains - Victor & Arthur</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg:#f4f6f9; --card:#fff; --text:#111827; --accent:#2563eb;
  --victor-color:#2563eb; --arthur-color:#10b981;
}
body.dark {
  --bg:#0f172a; --card:#1e293b; --text:#e5e7eb; --accent:#38bdf8;
  --victor-color:#3b82f6; --arthur-color:#10b981;
}
body { margin:0; font-family:Arial; background:var(--bg); color:var(--text); }
header { padding:20px; display:flex; justify-content:space-between; align-items:center; }
button {
  background:var(--accent); border:none; color:white;
  padding:8px 14px; border-radius:8px; cursor:pointer;
}
.card {
  background:var(--card); padding:20px; border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  margin-bottom:20px;
}
.dashboard {
  display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px; padding:20px;
}
.amount { font-size:26px; font-weight:bold }
.form-container {
  padding:20px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:20px;
}
.person-form {
  background:var(--card);
  padding:20px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
.person-form h3 {
  margin-top:0;
  padding-bottom:10px;
  border-bottom:2px solid;
}
.person-form.victor h3 {
  color:var(--victor-color);
  border-color:var(--victor-color);
}
.person-form.arthur h3 {
  color:var(--arthur-color);
  border-color:var(--arthur-color);
}
form { display:flex; flex-direction:column; gap:10px; }
input, select { padding:10px; border-radius:8px; border:1px solid #ddd; }
.person-toggle {
  display:flex;
  gap:10px;
  padding:20px;
}
.person-toggle button {
  flex:1;
  opacity:0.6;
  transition:all 0.3s;
}
.person-toggle button.active {
  opacity:1;
  transform:scale(1.05);
}
#charts { padding:20px; }
.stat-row {
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  padding:10px;
  border-radius:8px;
  background:var(--bg);
}
.stat-label {
  font-weight:bold;
}
.stat-value {
  font-weight:bold;
}
</style>
</head>

<body>

<header>
  <h1>ðŸ“Š Gestion des gains - Victor & Arthur</h1>
  <button onclick="toggleDark()">ðŸŒ™</button>
</header>

<div class="person-toggle">
  <button onclick="showPerson('victor')" id="victor-toggle" class="active">Victor</button>
  <button onclick="showPerson('arthur')" id="arthur-toggle">Arthur</button>
  <button onclick="showBoth()" id="both-toggle">Les deux</button>
</div>

<div class="form-container">
  <div class="person-form victor">
    <h3>ðŸ‘¤ Victor - Gains</h3>
    <form onsubmit="addGain(event, 'victor')">
      <input type="date" id="victor-date" required>
      <input type="number" id="victor-amount" placeholder="â‚¬ gagnÃ©s" required min="0" step="0.01">
      <button type="submit" style="background:var(--victor-color)">Ajouter gain</button>
    </form>
    <div class="stats">
      <div class="stat-row">
        <span class="stat-label">Total Victor:</span>
        <span class="stat-value" id="victor-total">0 â‚¬</span>
      </div>
    </div>
  </div>

  <div class="person-form arthur">
    <h3>ðŸ‘¤ Arthur - Gains</h3>
    <form onsubmit="addGain(event, 'arthur')">
      <input type="date" id="arthur-date" required>
      <input type="number" id="arthur-amount" placeholder="â‚¬ gagnÃ©s" required min="0" step="0.01">
      <button type="submit" style="background:var(--arthur-color)">Ajouter gain</button>
    </form>
    <div class="stats">
      <div class="stat-row">
        <span class="stat-label">Total Arthur:</span>
        <span class="stat-value" id="arthur-total">0 â‚¬</span>
      </div>
    </div>
  </div>
</div>

<section class="dashboard">
  <div class="card" onclick="openCharts()">
    <h3>Total CombinÃ©</h3>
    <div id="total" class="amount">0 â‚¬</div>
  </div>
  <div class="card">
    <h3>Hier</h3>
    <div id="yesterday" class="amount">0 â‚¬</div>
  </div>
  <div class="card">
    <h3>Semaine</h3>
    <div id="week" class="amount">0 â‚¬</div>
  </div>
  <div class="card">
    <h3>Mois</h3>
    <div id="month" class="amount">0 â‚¬</div>
  </div>
  <div class="card">
    <h3>AnnÃ©e</h3>
    <div id="year" class="amount">0 â‚¬</div>
  </div>
</section>

<section id="charts">
  <div class="card">
    <h3>Graphique des gains</h3>

    <select id="period" onchange="drawChart()">
      <option value="today">Aujourd'hui</option>
      <option value="7">7 derniers jours</option>
      <option value="30">30 derniers jours</option>
      <option value="month">Ce mois</option>
      <option value="year">Cette annÃ©e</option>
      <option value="all">Tout</option>
    </select>

    <canvas id="chart" height="300"></canvas>
  </div>
</section>

<script>
// DonnÃ©es sÃ©parÃ©es pour Victor et Arthur
let victorGains = JSON.parse(localStorage.getItem("victorGains") || "[]");
let arthurGains = JSON.parse(localStorage.getItem("arthurGains") || "[]");
let currentView = 'both'; // 'victor', 'arthur', or 'both'

function addGain(e, person) {
  e.preventDefault();
  
  const gain = {
    date: document.getElementById(`${person}-date`).value,
    amount: Number(document.getElementById(`${person}-amount`).value),
    person: person
  };
  
  if (person === 'victor') {
    victorGains.push(gain);
    localStorage.setItem("victorGains", JSON.stringify(victorGains));
  } else {
    arthurGains.push(gain);
    localStorage.setItem("arthurGains", JSON.stringify(arthurGains));
  }
  
  e.target.reset();
  refresh();
  drawChart();
}

function sum(gainsArray, filter) {
  return gainsArray.filter(filter).reduce((s,g)=>s+g.amount,0);
}

function refresh() {
  let now = new Date();
  let yesterday = new Date(now); 
  yesterday.setDate(now.getDate()-1);
  
  // Totaux individuels
  const victorTotal = sum(victorGains, () => true);
  const arthurTotal = sum(arthurGains, () => true);
  
  document.getElementById("victor-total").innerText = victorTotal.toFixed(2) + " â‚¬";
  document.getElementById("arthur-total").innerText = arthurTotal.toFixed(2) + " â‚¬";
  
  // Totaux combinÃ©s
  const allGains = [...victorGains, ...arthurGains];
  
  document.getElementById("total").innerText = (victorTotal + arthurTotal).toFixed(2) + " â‚¬";
  document.getElementById("yesterday").innerText = 
    sum(allGains, g => new Date(g.date).toDateString() === yesterday.toDateString()).toFixed(2) + " â‚¬";
  document.getElementById("week").innerText = 
    sum(allGains, g => (now - new Date(g.date)) / 86400000 <= 7).toFixed(2) + " â‚¬";
  document.getElementById("month").innerText = 
    sum(allGains, g => new Date(g.date).getMonth() === now.getMonth() && 
                      new Date(g.date).getFullYear() === now.getFullYear()).toFixed(2) + " â‚¬";
  document.getElementById("year").innerText = 
    sum(allGains, g => new Date(g.date).getFullYear() === now.getFullYear()).toFixed(2) + " â‚¬";
}

// Initialisation du graphique
let chart = new Chart(document.getElementById("chart").getContext('2d'), {
  type: "line",
  data: {
    labels: [],
    datasets: [
      {
        label: "Victor",
        data: [],
        borderColor: "var(--victor-color)",
        backgroundColor: "rgba(37, 99, 235, 0.1)",
        fill: true,
        tension: 0.4,
        borderWidth: 2
      },
      {
        label: "Arthur",
        data: [],
        borderColor: "var(--arthur-color)",
        backgroundColor: "rgba(16, 185, 129, 0.1)",
        fill: true,
        tension: 0.4,
        borderWidth: 2
      }
    ]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        position: 'top',
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        title: {
          display: true,
          text: 'Montant (â‚¬)'
        }
      },
      x: {
        title: {
          display: true,
          text: 'Date'
        }
      }
    }
  }
});

function drawChart() {
  const p = document.getElementById("period").value;
  const now = new Date();
  
  // PrÃ©parer les donnÃ©es selon la vue courante
  let dataToShow = {
    victor: currentView === 'victor' || currentView === 'both',
    arthur: currentView === 'arthur' || currentView === 'both'
  };
  
  // Filtrer et grouper les donnÃ©es
  let victorMap = {};
  let arthurMap = {};
  let allDates = new Set();
  
  [victorGains, arthurGains].forEach((gainsArray, index) => {
    gainsArray.forEach(g => {
      let d = new Date(g.date);
      let shouldInclude = false;
      
      if (p === "today") shouldInclude = d.toDateString() === now.toDateString();
      else if (p === "7") shouldInclude = (now - d) / 86400000 <= 7;
      else if (p === "30") shouldInclude = (now - d) / 86400000 <= 30;
      else if (p === "month") shouldInclude = d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
      else if (p === "year") shouldInclude = d.getFullYear() === now.getFullYear();
      else if (p === "all") shouldInclude = true;
      
      if (shouldInclude) {
        const dateKey = d.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' });
        allDates.add(dateKey);
        
        if (g.person === 'victor') {
          victorMap[dateKey] = (victorMap[dateKey] || 0) + g.amount;
        } else {
          arthurMap[dateKey] = (arthurMap[dateKey] || 0) + g.amount;
        }
      }
    });
  });
  
  // Trier les dates
  const sortedDates = Array.from(allDates).sort((a, b) => {
    return new Date(a.split('/').reverse().join('-')) - new Date(b.split('/').reverse().join('-'));
  });
  
  // PrÃ©parer les donnÃ©es pour le graphique
  const victorData = sortedDates.map(date => victorMap[date] || 0);
  const arthurData = sortedDates.map(date => arthurMap[date] || 0);
  
  // Mettre Ã  jour le graphique
  chart.data.labels = sortedDates;
  chart.data.datasets[0].data = dataToShow.victor ? victorData : [];
  chart.data.datasets[1].data = dataToShow.arthur ? arthurData : [];
  chart.update();
}

function showPerson(person) {
  currentView = person;
  
  // Mettre Ã  jour les boutons
  document.getElementById('victor-toggle').classList.remove('active');
  document.getElementById('arthur-toggle').classList.remove('active');
  document.getElementById('both-toggle').classList.remove('active');
  document.getElementById(`${person}-toggle`).classList.add('active');
  
  drawChart();
}

function showBoth() {
  currentView = 'both';
  
  // Mettre Ã  jour les boutons
  document.getElementById('victor-toggle').classList.remove('active');
  document.getElementById('arthur-toggle').classList.remove('active');
  document.getElementById('both-toggle').classList.add('active');
  
  drawChart();
}

function openCharts() {
  document.getElementById("charts").scrollIntoView({ behavior: 'smooth' });
  drawChart();
}

function toggleDark() {
  document.body.classList.toggle("dark");
  // Mettre Ã  jour les couleurs du graphique
  chart.data.datasets[0].borderColor = getComputedStyle(document.documentElement).getPropertyValue('--victor-color');
  chart.data.datasets[1].borderColor = getComputedStyle(document.documentElement).getPropertyValue('--arthur-color');
  chart.update();
}

// Initialisation
refresh();
drawChart();

// Remplir la date d'aujourd'hui par dÃ©faut
const today = new Date().toISOString().split('T')[0];
document.getElementById('victor-date').value = today;
document.getElementById('arthur-date').value = today;
</script>

</body>
          </html>
          
